Create a PowerShell deployment script called deploy.ps1 in the deploy-infra folder that fully automates the infrastructure deployment.

The script should accept parameters for the resource group name (required), Azure region (required), a base name for resources (optional, defaults to "expensemgmt"), a switch to deploy GenAI resources like Azure OpenAI and AI Search, and a switch to skip database setup for redeployments.

The deployment process should:

1. Check that Azure CLI is installed and the user is logged in
2. Automatically retrieve the current user's Azure AD credentials (Object ID and User Principal Name)
3. Create the resource group if needed
4. Deploy all infrastructure using the Bicep templates
5. Wait for SQL Server to become ready before proceeding
6. Add the user's current IP address to the SQL Server firewall
7. Import the database schema using sqlcmd with Entra ID authentication
8. Create a database user for the managed identity and grant it read, write, and execute permissions
9. Create the stored procedures required by the application
10. Configure the App Service with connection strings and settings
11. If GenAI resources were deployed, configure the OpenAI and Search endpoints

The script should provide clear progress indicators, handle errors gracefully, and display a summary of deployed resources at the end.

Important: Use sqlcmd with the --authentication-method=ActiveDirectoryDefault flag for all database operations. The script should warn users if they're running PowerShell 5.1 and recommend upgrading to PowerShell 7+.

Prerequisites: Azure CLI, sqlcmd (install with winget install sqlcmd), and PowerShell 7+ recommended.
